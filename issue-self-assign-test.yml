name: 'ğŸ§‘â€ğŸ’» ì´ìŠˆ: ì‘ì„±ì ìë™ í• ë‹¹'

on:
  issues:
    types: [opened]

permissions:
  issues: write

jobs:
  self_assign:
    name: 'ğŸ‘¤ ì‘ì„±ìë¥¼ ë‹´ë‹¹ìë¡œ ìë™ ì§€ì •'
    runs-on: ubuntu-latest
    steps:
      - name: 'ğŸ·ï¸ ì‘ì„±ì ì¶”ê°€ (ì´ë¯¸ ë°°ì •ì´ë©´ ê±´ë„ˆëœ€) + ì„±ê³µ ì‹œ ëŒ“ê¸€'
        uses: actions/github-script@v7
        with:
          script: |
            const { owner, repo } = context.repo;
            const issue = context.payload.issue;
            const issue_number = issue.number;
            const author = issue.user.login;

            const assignees = Array.isArray(issue.assignees) 
              ? issue.assignees.map(a => a.login) 
              : [];

            // 1) ì‘ì„±ìê°€ ì´ë¯¸ ë‹´ë‹¹ìë©´ ì¢…ë£Œ
            if (assignees.includes(author)) {
              core.info(`â„¹ï¸ @${author} ì´ë¯¸ ë‹´ë‹¹ìì…ë‹ˆë‹¤. ê±´ë„ˆëœ€ (#${issue_number})`);
              return;
            }

            // 2) ì‘ì„±ìë¥¼ Assigneeë¡œ ì¶”ê°€
            await github.rest.issues.addAssignees({
              owner, repo, issue_number,
              assignees: [author],
            });
            core.info(`âœ… @${author} ë‹˜ì„ #${issue_number} ì´ìŠˆì˜ ë‹´ë‹¹ìë¡œ ì§€ì • ì™„ë£Œ`);

            // 3) (ì˜µì…˜) ë§ˆì¼ìŠ¤í†¤ ìë™ ì§€ì •
            /*
            let milestoneNote = '';
            if (issue.milestone) {
              core.info(`â„¹ï¸ ì´ë¯¸ ë§ˆì¼ìŠ¤í†¤ì´ ì§€ì •ë˜ì–´ ìˆì–´ ê±´ë„ˆëœë‹ˆë‹¤: ${issue.milestone.title}`);
            } else {
              const milestones = await github.paginate(
                github.rest.issues.listMilestones,
                { owner, repo, state: 'open', sort: 'due_on', direction: 'asc', per_page: 100 }
              );
              const now = new Date();
              const upcoming = milestones.filter(m => m.due_on && new Date(m.due_on) >= now);
              if (upcoming.length > 0) {
                const target = upcoming[0];
                await github.rest.issues.update({
                  owner, repo, issue_number,
                  milestone: target.number,
                });
                core.info(`ğŸ—“ï¸ ë§ˆì¼ìŠ¤í†¤ ìë™ ì§€ì •: ${target.title} (due ${target.due_on})`);
                milestoneNote = `\nğŸ—“ï¸ ë§ˆì¼ìŠ¤í†¤: **${target.title}** (ë§ˆê° ${String(target.due_on).slice(0,10)})ë¡œ ìë™ ì§€ì •í–ˆì–´ìš”.`;
              } else {
                core.info('â„¹ï¸ ë§ˆê°ì¼ì´ ìˆëŠ” ì—´ë¦° ë§ˆì¼ìŠ¤í†¤ì„ ì°¾ì§€ ëª»í•´ ê±´ë„ˆëœë‹ˆë‹¤.');
              }
            }
            */

            // 4) ì„±ê³µ ëŒ“ê¸€
            await github.rest.issues.createComment({
              owner, repo, issue_number,
              // ë§ˆì¼ìŠ¤í†¤ ì§€ì • ê¸°ëŠ¥ê¹Œì§€ ì‚¬ìš©í•  ê²½ìš° ì•„ë˜ ë¬¸êµ¬ì— milestoneNote ë³€ìˆ˜ë¥¼ ì¶”ê°€í•˜ì„¸ìš”.
              // body: `âœ… @${author} ë‹˜ì„ ì´ ì´ìŠˆì˜ ë‹´ë‹¹ìë¡œ ìë™ ì§€ì •í–ˆì–´ìš”!${milestoneNote}`
              body: `âœ… @${author} ë‹˜ì„ ì´ ì´ìŠˆì˜ ë‹´ë‹¹ìë¡œ ìë™ ì§€ì •í–ˆì–´ìš”!`
            });
